# cYSP & Visindigo

cYSP播放器，以及cYSP播放器的下一代套（重）壳（构）版本Visindigo。

鉴于cYSP仅将YSP从Python翻译到C++，而YSP又是我刚刚学会一点点面向对象的小玩意的时候就开始写的东西，因此十分的具有“基础不牢地动山摇”的特点。原计划是试着在cYSP基础上直接加GPOL支持，但是目前看来并不好实现。所以现在给cYSP开了一个分支，叫做Visindigo。Visindigo在完成之后应该仅保留cYSP播放页本身以及AASPCMD解释器这两个部分的源码，其他的部分会悉数重写，重新组织程序结构。并且由于已经将原来计划的第一版的GPOL通过Python实现为PyGP，因此现在说的GPOL指的是用于将Visindigo内部函数暴露出来的GPOL字节码，相当于一种简单的接口标准。

至于后来说的要“重头弄一种脚本语言”而设想的第二版的GPOL，这玩意算是遥遥无期了，如果有的话我们会将其称之为VIL。关于VIL的相关技术通路的问题，坦白交代，我没打通。所以我现在在学习Python的解释器的相关原理。有一些用于解释的早期零散函数与内容可能并不会在本项目内更新（无论是cYSP还是Visindigo）。它们倒是可能出现在本人的另外一个项目里，也就是CommonEdit。CommonEdit的CEOperation部分有一个文件是CEScript，里面基本上就算是VIL解释器的前期工作了。

实际上，Visindigo的提出并不比CommonEdit项目要早，所以Visindigo很大程度上会吃一些CommonEdit的红利，因为CommonEdit里面收集了一些我自己写的其他轮子，可以直接拿过来给Visindigo用。

cYSP在接下来一段时间可能并不会更新，但是如果Visindigo开发的实在是太慢了，我会弄一些新功能放到cYSP里面作为缓冲。

# Ver0.9.0_Pre3(Build137.0)

进行了若干优化与修复

从代码中剔除或替换了无法跨平台的内容，并且将部分文件编码替换为了UTF-8，正在为跨平台部署做准备

## Ver0.9.0_Pre2.1(Build136.1)

为更新解释器代码做出了实验。现在背景控制器的识别由全新的代码组成。

修复了播放页无法正确读入已经生成的背景缓存的问题。

## Ver0.9.0_Pre2.1(Build136.0)

替换了程序全局变量的部分实现方式。

## Ver0.9.0_Pre2(Build135.3)

修复了遮罩控制器在跳转行时未被回溯的问题。

重构了回溯算法

更改了部分控件的位置

## Ver0.9.0_Pre2(Build135.2)

修复了遮罩控制器不能正确控制关闭的问题

屏蔽了解释器启动阶段的Esc快捷键以防止崩溃。

## Ver0.9.0_Pre2(Build135.0)

重构了讲述控制器在解释器识别后传递到UI的逻辑。该项更改解决了分离式讲述控制器同名换行时造成的闪烁问题。

修复了错误将讲述控制器的淡入参数作为淡出参数的问题。

## Ver0.9.0_Pre2(Build134.0)

引入了程序内部浮动消息服务

修复了一个可能导致解释器假死的问题

重新设计了UI的动画逻辑，现在不存在阻塞性动画。

重新让自动小三角动画跟随设定速度调整快慢

## Ver0.9.0_Pre1(Build131.4)_SPOL0.8.0 \ Ver0.9.0_Pre1(Build131.0)_SPOL0.8.0

更新至SPOL.9X语法，暂定使用0.8.0作为开发中的0.9.0的代称。

自动隐藏命令行页面。

非常重要的，原来的立绘名称最后的下划线在没有表情的时候可以省略了。

更改了标题控制器，背景控制器，音乐控制器，音效控制器的写法。

实装了讲述控制器的淡入淡出功能。

将遮罩的开闭独立为新的遮罩状态控制器，不再使用“>>>:”与">>>:>>>:"临时控制遮罩状态。

启用了SPOL.9X设计的自由叠合滤镜系统。

在内部增加了使用PL启动器启动程序的支持，为以后的某些功能做铺垫。

所有可以交给用户设置的素材文件均已被移入新的文件夹“Users_Data”下。

131.4版本修复了131.0版本中由于引入PL启动器支持而无法正常从中文路径启动的问题。现在已知该问题还会影响文件夹链接页面的使用。

修复了在回溯音乐控制器的时候会错误回溯音效控制器的问题。

# Ver0.8.2_Pub(Build120.10020)_SPOL0.6.5\Ver0.8.1_Pub(Build120.10010)_SPOL0.6.5

修复了抖动特效无法正常播放的问题

修复了标题消失时帧数低于预期帧数的问题

修复了切换语言时，选择语言对话框的标题无法正常显示的问题

修复了跳转页面的回溯算法会错误留存其他文档的回溯信息的问题，该问题导致连续播放剧情时会使后续剧情在跳转时错误显示之前剧情的素材

修复了在某些情况下，回溯算法不能回溯音乐控制器的问题

修复了解释器会错误的把第一个讲述人立绘的滤镜加到第二个讲述人立绘之上的问题

修正了附带的指导文档中的部分错误

## Ver0.8.0_Pub(Build120.1000)_SPOL0.6.5

修复了未订正的翻译系统内部文本

完成了余下的翻译工作

## Ver0.8.0_Pre4(Build120.0)_SPOL0.6.5

修复了文档内只有版本声明行与标题控制器，没有其他与剧情内容实际相关的控制器时程序会崩溃的问题

修复了两人对话时立绘交替变暗功能未生效的问题

修复了一个滤镜运算时的精度错误，它导致褪色滤镜效果与原Python版褪色滤镜效果不一致

修复了一个防闪烁模块的问题，它导致Qt频繁报错“无效图像”（不影响运行）

修复了一个图像翻转的问题，它导致找不到立绘的讲述控制器会引起Qt报错“无效图像”（不影响运行）

屏蔽了一部分本版中不再计划启用的功能

## Ver0.8.0_Pre3(Build118.0)_SPOL0.6.5

完善了UI功能，但屏蔽了部分不会在本版中启用的UI

恢复了快捷键功能

对程序内存占用情况做出了优化

对程序主页的性能做出了优化

对内核引入了IFL规定，以及根据IFL重新确定了九个标准解释器异常（EIFL）

重新规定了翻译系统的文本内部名称

清理了部分不使用的翻译文本

清理了部分不使用的内核信息

清理了部分内核冗余

## Ver0.8.0_Pre2(Build115.0)_SPOL0.6.5

增加了部分UI

新增了SPOLDev的半可视化编辑（已有源码，但被注释屏蔽）

## Ver0.8.0_Pre1.1(Build111.0)_SPOL0.6.5

修复了更换语言时产生的闪退问题

移除了相当一部分解释器运行时对控制台输出的debug文本

移除了部分未使用的头文件和重复的include文件

更改了解释器在从标题进入播放状态时生成跳转列表的执行顺序

增强了代码的可读性

## Ver0.8.0_Pre1(Build110.514)_SPOL0.6.5

完成了音乐控制器、音效控制器

完成了大分支控制器的识别

修复了未生效的大分支后处理算法

修复了QtWordgame中存在的若干错误的内存管理算法

增强了代码的可读性

## Ver0.8.0_Pre1_PT4(Build110.4080)_SPOL0.6.5

调整了背景控制器的第一阶段留存时间

给图像处理线程等待时间给予5秒的等待上限，避免因为线程冲突导致计数不归零、进而引发程序假死的问题。

修复了程序在非1080高度的分辨率下（尤其是低于1080高度的分辨率时），跳转行文本的显示缺失、左右错位等问题。

修复了回溯长时性控制器算法未生效的问题。

修复了跳转行页面可能会显示一个离谱的大数值的问题。

修复了跳转行页面可能会错误显示其他行数值的问题。

修复了讲述控制器的自动换行无法识别东亚方块字（中文、韩文、日文），进而导致文本超界的问题。

修复了在用户违反SPOL语法，错误的使用两个有讲述文本的讲述控制器时，程序会崩溃的问题。

修复了小分支控制器未能正确定位分支区域的问题。

## Ver0.8.0_Pre1_PT3(Build110.3000)_SPOL0.6.5

完成了讲述控制器的初步识别

修复了解释器和UI通信过程中所出现的Bug

更改QtWordGame下讲述控制器的图像名称机制为新版机制

## Ver0.8.0_Pre1_PT2(Build110.0010)_SPOL0.6.5

完成了小分支控制器的解释与UI正常显示

完成了跳转功能

在测试新版本播放页面期间，进入程序后优先进入播放页面而不是程序主页

为一些代码新增了注释，增强可读性

修复了QtWordGame中的一些代码错误

更改了writesettings函数，从int类型变成了void类型

修正了不正确的版本号，现在明确SPOL版本为0.6.5，仅用来标示是新版本解释器，其功能与Python的最后一版0.6.0版本基本一致。0.6.0可以直接使用FollowNew与新版兼容

## Ver0.8.0_Pre1_PT1(Build110.0)_SPOL0.6.5

* 这是第一个C++版本的YSP的第一个测试版本的第一个预测版本，您将体验到数倍于Python版本YSP的运算性能与图形性能提升。具体提升幅度取决于您的CPU核心数量。
* 需要说明的是，本预测版本并不能正常使用——解释器只完成了背景控制器的识别。

新增了SPOL编辑器（SPOLDev）页面，取代第三方的SPOL编辑器。

增强了更新推送系统，程序现在会在告知可以更新时同时列出更新日志的链接（若未提供更新日志则也会标明无日志）。新的更新推送系统与老版本YSP兼容，您不必担心保留在您计算机上的老版本YSP因为升级更新推送机制而无法正常接受更新，或是在运行时崩溃。

更改了交互页面（今后称作程序主页）的外观设计。该设计是一个缓冲方案，日后会继续更改。

取消了程序执行时的SPOL语法报错，更改为在SPOLDev下启动播放前的集中报错。（暂未实装）

重新决定了在播放剧情时有哪些信息需要被推到控制台上显示。

新增了GCP模式。该模式目前只是个空壳子，后期会继续完善。

取消了YSP程序从双击SPOL文件打开时，直接进入播放页面并播放的功能。该功能将会在SPOLDev进一步开发之后于SPOLDev页面间接恢复。

经过长期观察，我们发现CrashReport内容大部分都是程序逻辑错误与SPOL引起的错误，没有其他意外错误，故取消了CrashReport报错系统。

改变了滤镜系统的算法，现在不会产生“缓存的缓存”，并且缓存文件命名与之前有差别，不能使用之前的缓存文件。上述改变均在为下一版SPOL做准备。

由于新版滤镜系统效率过高，因此现在在每次播放剧情之前都会对所有图像进行滤镜运算，并不像老版本的滤镜系统那样会跳过已经被运算过且已经缓存图像。这项更改可以杜绝老版本中更改原图后缓存图像无法自动更新的问题。

不再使用语言文件夹下的base.ini作为记录语言设置的文件。

新增记录程序统一设置的文件options.txt，部分敏感设置存储在注册表而非此文件之内。这意味着您的多个YSP程序将会共享相同的敏感设置。

新增程序设置：播放分辨率、播放窗口化、GCP模式切换（前两项现在只能通过改options实现））

允许在options.txt内通过调整Update_Channel更改更新接受通道，Auto为沿用当前通道，Pre为预览通道（内部渠道），Pub为公开通道（正式渠道）

允许在options.txt内通过调整Forced_Debugging_Info值为True在公开版本中启用内测版本的部分调试信息，这些调试信息大多为程序运行信息，于用户正常使用无益。

增强了按行跳转算法，现在会自动追加解释目标行之前的最后一个背景控制器和音乐控制器，以达到正常显示与扬声效果。

新增健康游戏忠告（仅在简体中文时显示）
